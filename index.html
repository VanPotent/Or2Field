<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orion to Rayfield Converter</title>
  <!-- Inline Prism.js dark theme CSS for syntax highlighting -->
  <style>
    body {
      margin: 0; padding: 0;
      background: #1e1e1e; color: #ffffff; 
      font-family: "Segoe UI", Tahoma, sans-serif;
    }
    header {
      display: flex; align-items: center;
      padding: 0.5em 1em;
      border-bottom: 1px solid #333;
      background: #252526;
    }
    #logo {
      height: 40px; width: 40px;
      margin-right: 0.5em;
    }
    header h1 {
      font-size: 1.2em;
      font-weight: normal;
      margin: 0;
    }
    .container {
      display: flex; flex-wrap: wrap;
      padding: 1em;
    }
    .code-panel {
      flex: 1 1 500px; /* flex-grow and minimum width */
      display: flex; flex-direction: column;
      margin: 0.5em;
    }
    .code-panel label {
      font-weight: bold;
      margin-bottom: 0.3em;
    }
    .code-panel pre, .code-panel textarea {
      background: #1e1e1e;
      color: #ffffff;
      font-family: Consolas, "Courier New", monospace;
      font-size: 0.95em;
      line-height: 1.4;
      padding: 0.75em;
      border: 1px solid #3c3c3c;
      border-radius: 4px;
      width: 100%;
      box-sizing: border-box;
      overflow: auto;
      white-space: pre; /* preserve whitespace */
    }
    textarea#inputCode {
      min-height: 300px;
      resize: vertical;
    }
    pre#outputPre {
      min-height: 300px;
      margin: 0;
    }
    /* Buttons row */
    .buttons {
      display: flex;
      align-items: center;
      margin: 1em 0;
    }
    .buttons button {
      background: #0e639c;
      color: white;
      border: none;
      padding: 0.5em 1em;
      font-size: 0.9em;
      cursor: pointer;
      border-radius: 4px;
      margin-right: 1em;
      display: inline-flex;
      align-items: center;
    }
    .buttons button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .buttons #spinner {
      width: 16px; height: 16px;
      border: 3px solid #ffffff;
      border-top: 3px solid transparent;
      border-radius: 50%;
      margin-right: 0.5em;
      animation: spin 1s linear infinite;
      display: none;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .buttons .copy-confirm {
      font-size: 0.85em;
      color: #6cf0a9;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .buttons .copy-confirm.show {
      opacity: 1;
    }
    /* PrismJS Dark theme syntax highlighting (Lea Verou's theme) */
    code[class*="language-"], pre[class*="language-"] {
      color: white;
      background: none;
      text-shadow: 0 -0.1em 0.2em black;
      font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
      text-align: left;
      white-space: pre;
      word-break: normal;
      word-wrap: normal;
      line-height: 1.5;
      tab-size: 4;
      -moz-tab-size: 4;
      -o-tab-size: 4;
    }
    /* Code blocks background */
    pre[class*="language-"], :not(pre) > code[class*="language-"] {
      background: hsl(30, 20%, 25%);
    }
    pre[class*="language-"] {
      padding: 1em;
      margin: 0.5em 0;
      overflow: auto;
      border: 0.3em solid hsl(30, 20%, 40%);
      border-radius: 0.5em;
      box-shadow: 1px 1px 0.5em black inset;
    }
    :not(pre) > code[class*="language-"] {
      padding: 0.15em 0.2em 0.05em;
      border-radius: 0.3em;
      border: 0.13em solid hsl(30, 20%, 40%);
      box-shadow: 1px 1px 0.3em -0.1em black inset;
      white-space: normal;
    }
    /* Token colors */
    .token.comment, .token.prolog, .token.doctype, .token.cdata {
      color: hsl(30, 20%, 50%);
    }
    .token.punctuation {
      opacity: 0.7;
    }
    .namespace {
      opacity: 0.7;
    }
    .token.property, .token.tag, .token.boolean, .token.number, .token.constant, .token.symbol {
      color: hsl(350, 40%, 70%);
    }
    .token.selector, .token.attr-name, .token.string, .token.char, .token.builtin, .token.inserted {
      color: hsl(75, 70%, 60%);
    }
    .token.operator, .token.entity, .token.url, .language-css .token.string, .style .token.string, .token.variable {
      color: hsl(40, 90%, 60%);
    }
    .token.atrule, .token.attr-value, .token.keyword {
      color: hsl(350, 40%, 70%);
    }
    .token.regex, .token.important {
      color: #e90;
    }
    .token.important, .token.bold {
      font-weight: bold;
    }
    .token.italic {
      font-style: italic;
    }
    .token.entity {
      cursor: help;
    }
    .token.deleted {
      color: red;
    }
  </style>
  <!-- Inline Prism JS (core + Lua language) for syntax highlighting -->
  <script>
    /*! PrismJS core - https://prismjs.com/download.html (Minified) */
    window.Prism = (function(){var e=/\blang(?:uage)?-([\w-]+)\b/i,t=0,n={manual:void 0,disableWorkerMessageHandler:void 0},a={};function r(e){var t=a[e];if(!t){var n=document.getElementsByTagName("script");t="";for(var r in n) if(n[r].src&&n[r].src.indexOf("prism")!==-1){t=n[r].src;break}}var i={};if(t){var s=t.replace(/[\w-]+\.js(\?.*)?$/,"");e&&(i.complete+=s+"components/prism-"+e+".min.js"),i.complete&&document.write('<script src="'+i.complete+'"></script>')}return i}function i(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")}function s(e){var t=document.createElement("div");t.textContent=e;return t.innerHTML}function l(e,t){return e.replace(/<<(\d+)>>/g,function(e,n){return'<span class="token '+t+'">'+i(n)+'</span>'})}function o(e,t){return'<span class="token '+t+'">'+i(e)+"</span>"}function u(e){var t=e.substring(1);if(!a[t]){var n=r(t);n.complete&&document.write('<script src="'+n.complete+'"></script>')}}function g(e){return e.cloneNode(!0)}function f(e){for(var t in e) if(e.hasOwnProperty(t)) return !1;return !0}function c(e){var t=(n.manual?{before:document}:document).querySelectorAll("code[class*='language-'], [class*='language-'] code, code[class*='lang-'], [class*='lang-'] code");for(var a=0;a<t.length;a++){var r=t[a];if(!r.parentElement||!r.parentElement.matches("pre")) continue;var i=r.className.match(e)||r.parentElement.className.match(e);if(i){var s=i[1].toLowerCase();r.className=("language-"+s);var l=r.parentElement;l.className=("language-"+s);var o=r.textContent;if(r.children.length){if(o.trim()){r.innerHTML=o}r.innerHTML=function e(t,n){var a=n?o(n):n;return t.replace(/<<(\d+)>>/g,function(t,n){return e(a,n)})}(r.innerHTML,{})}var u={element:r,language:s,grammar:a.languages[s],code:o};a.highlight(u.code,u.grammar,u.language,u)}}}var d={manual:n.manual,util:{encode:i,clone:g,type:function(e){return Object.prototype.toString.call(e).slice(8,-1)},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++t}),e.__id},cloneDeep:function e(t,n){var r=d.util.clone(t);for(var i in t) if(t.hasOwnProperty(i)){var s=t[i],l=d.util.type(s);l==="Object"&&n?l=null:l==="Array"&&(l=null);if(l){r[i]=s}else if(d.util.type(s)==="Object"){r[i]=e(s)}}return r}},languages:{extend:function(e,t){var n=d.util.cloneDeep(d.languages[e]);for(var a in t) n[a]=t[a];return n},insertBefore:function(t,n,a,r){var i=(r=r||d.languages)[t];var s={};for(var l in i){if(i.hasOwnProperty(l)){if(l==n) for(var o in a){if(a.hasOwnProperty(o)){s[o]=a[o]}}s[l]=i[l]}}var u=r[t];return r[t]=s,!0},DFS:function(e,t,n,a){a=a||{};for(var r in e) if(e.hasOwnProperty(r)){t.call(e,r,e[r],n||r);var i=e[r];if(d.util.type(i)==="Object"&&!a[d.util.objId(i)]){a[d.util.objId(i)]=!0;d.languages.DFS(i,t,null,a)}else if(d.util.type(i)==="Array"&&!a[d.util.objId(i)]){a[d.util.objId(i)]=!0;d.languages.DFS(i,t,r,a)}}}},plugins:{},highlight:function(e,n,a,r){var i={code:e,grammar:n,language:a};d.hooks.run("before-highlight",i);if(!i.grammar){i.element.textContent=i.code;d.hooks.run("after-highlight",i);return i.code}var s=i.grammar;var l=Tokenizer.tokenize(i.code,s);i.highlightedCode=Token.stringify(l,i.language);d.hooks.run("before-insert",i);i.element.innerHTML=i.highlightedCode;d.hooks.run("after-highlight",i);return i.highlightedCode},hooks:{all:{},add:function(e,t){var n=d.hooks.all;n[e]=n[e]||[];n[e].push(t)},run:function(e,t){var n=d.hooks.all[e];if(!n||!n.length) return;for(var a=0;a<n.length;a++) n[a](t)}}};var Token=function(e,t,n,a){this.type=e;this.content=t;this.alias=n;this.length=0|(a||"").length};Token.stringify=function(e,t){if(typeof e=="string"){return e}if(Array.isArray(e)){return e.map(function(n){return Token.stringify(n,t)}).join("")}var n={type:e.type,content:Token.stringify(e.content,t),tag:"span",classes:["token",e.type],attributes:{},language:t};if(e.alias){var a=Array.isArray(e.alias)?e.alias:[e.alias];Array.prototype.push.apply(n.classes,a)}d.hooks.run("wrap",n);var r="";for(var i in n.attributes){r+=" "+i+'="'+(n.attributes[i]||"")+'"'}return "<"+n.tag+' class="'+n.classes.join(" ")+'"'+r+">"+n.content+"</"+n.tag+">"};return d})();

    /*! PrismJS Language: Lua (Minified) */
    Prism.languages.lua = {
      "comment": /^#!.+|--(?:\[(=*)\[[\s\S]*?\]\1\]|.*)/m,
      "string": {
        pattern: /\[(=*)\[[\s\S]*?\]\1\]|("|')(?:\\[\s\S]|(?!\2)[^\\])*\2/,
        greedy: !0
      },
      "number": /\b(?:0x[\da-fA-F]+|\d+(?:\.\d+)?(?:e[+-]?\d+)?)\b/,
      "keyword": /\b(?:and|break|do|else|elseif|end|for|goto|if|in|local|not|or|repeat|return|then|until|while)\b/,
      "function": /(?!\d)\w+(?=\s*(?:[({]))/,
      "operator": [/[-+*%^&|#]|\/\/?|<[<=]?|>[>=]?|[=~]=?/, {pattern: /(^|[^.])\.(?!\.)/, lookbehind: !0}],
      "punctuation": /[[\](){},;]|\.+|:+/
    };
  </script>
</head>
<body>
  <header>
    <img id="logo" src="https://raw.githubusercontent.com/VanPotent/VanPotent/b08471cc4c0bcad957ac6acba9fecc00c4dbc703/logo.png" alt="Logo">
    <h1>Orion-to-Rayfield Lua Converter</h1>
  </header>

  <div class="container">
    <!-- Orion script input panel -->
    <div class="code-panel">
      <label for="inputCode">Orion Script:</label>
      <textarea id="inputCode" placeholder="Paste Orion Library script here..."></textarea>
      <div class="buttons">
        <button id="convertBtn">
          <div id="spinner"></div>
          <span id="convertBtnText">Convert</span>
        </button>
        <button id="copyBtn">Copy Output</button>
        <span class="copy-confirm" id="copyConfirmMsg">Copied!</span>
      </div>
    </div>
    <!-- Rayfield script output panel -->
    <div class="code-panel">
      <label for="outputPre">Rayfield Script:</label>
      <pre id="outputPre"><code id="outputCode" class="language-lua"></code></pre>
    </div>
  </div>

  <!-- Conversion and interactive script -->
  <script>
    // Conversion function: transforms Orion script text to Rayfield script text
    function convertOrionToRayfield(src) {
      // Step 1: Replace Orion library load with Rayfield
      src = src.replace(/local\s+OrionLib\s*=\s*loadstring\(game:HttpGet\([^)]*\)\)\s*\(\)/i,
                        "local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()");
      // Step 2: Remove OrionLib:Init() calls (no equivalent in Rayfield)
      src = src.replace(/OrionLib:Init\(\)/gi, "");
      // Step 3: Replace OrionLib:MakeWindow with Rayfield:CreateWindow
      src = src.replace(/OrionLib:MakeWindow/gi, "Rayfield:CreateWindow");
      // Step 4: Transform window options (remove Orion-specific fields, add Rayfield config)
      // Remove HidePremium, IntroEnabled/Text/Icon, Icon (window icon), ConfigFolder, SaveConfig fields from the options table
      src = src.replace(/\bHidePremium\s*=\s*[^,}]+,?/gi, "")
               .replace(/\bIntroEnabled\s*=\s*[^,}]+,?/gi, "")
               .replace(/\bIntroText\s*=\s*[^,}]+,?/gi, "")
               .replace(/\bIntroIcon\s*=\s*[^,}]+,?/gi, "")
               .replace(/\bIcon\s*=\s*[^,}]+,?/gi, "")
               .replace(/\bSaveConfig\s*=\s*[^,}]+,?/gi, "")
               .replace(/\bConfigFolder\s*=\s*[^,}]+,?/gi, "");
      // Insert ConfigurationSaving block if SaveConfig was true
      if (/Rayfield:CreateWindow\s*\(\{[^}]*SaveConfig\s*=\s*true/i.test(src)) {
        src = src.replace(/Rayfield:CreateWindow\s*\(\{/i, match => {
          return match + 'ConfigurationSaving = { Enabled = true, FolderName = nil, FileName = "Config" }, ';
        });
      }
      // Remove any trailing commas in CreateWindow options
      src = src.replace(/,\s*}/g, " }");

      // Step 5: Replace Window:MakeTab with Window:CreateTab (handle Name and Icon)
      // We will handle tab conversion with a regex to capture Name and Icon values.
      src = src.replace(/:MakeTab\s*\(\{\s*Name\s*=\s*["']([^"']+)["'](?:\s*,\s*Icon\s*=\s*["']([^"']+)["'])?(?:\s*,\s*PremiumOnly\s*=\s*[^}]+)?\s*\}\)/gi,
        function(match, tabName, tabIcon) {
          let result = `:CreateTab("${tabName}"`;
          if (tabIcon) {
            // If icon is a Roblox asset id string, extract the numeric part
            const iconIdMatch = tabIcon.match(/rbxassetid:\/\/(\d+)/i);
            if (iconIdMatch) {
              result += `, ${iconIdMatch[1]}`;  // numeric ID
            } else if (/^\d+$/.test(tabIcon)) {
              result += `, ${tabIcon}`;        // numeric as string (no quotes needed)
            } else {
              result += `, "${tabIcon}"`;      // some other string (pass as quoted string, could be Lucide icon name)
            }
          }
          result += ")"; 
          return result;
        }
      );

      // Step 6: Simple one-to-one function name replacements for other elements
      src = src.replace(/:AddSection\(/gi, ':CreateSection(')
               .replace(/:AddLabel\(/gi, ':CreateLabel(')
               .replace(/:AddParagraph\(/gi, ':CreateParagraph(')
               .replace(/:AddButton\(/gi, ':CreateButton(')
               .replace(/:AddToggle\(/gi, ':CreateToggle(')
               .replace(/:AddDropdown\(/gi, ':CreateDropdown(')
               .replace(/:AddBind\(/gi, ':CreateKeybind(')
               .replace(/:AddColorpicker\(/gi, ':CreateColorPicker(')
               .replace(/:AddTextbox\(/gi, ':CreateInput(');
      // Also handle OrionLib:MakeNotification -> Rayfield:Notify
      src = src.replace(/OrionLib:MakeNotification/gi, 'Rayfield:Notify');

      // Step 7: Convert element options within braces:
      // Toggles, Sliders, Textboxes: Default -> CurrentValue
      src = src.replace(/\bDefault\s*=\s*(?!(?:Color3|Enum\.KeyCode))([^,}]+)/gi, 'CurrentValue = $1');
      // ColorPickers: Default -> Color
      src = src.replace(/\bDefault\s*=\s*Color3\.([^)]+\))/gi, 'Color = Color3.$1');
      // Keybinds: Default Enum.KeyCode -> CurrentKeybind "KeyName"
      src = src.replace(/\bDefault\s*=\s*Enum\.KeyCode\.([A-Za-z0-9_]+)/gi, 'CurrentKeybind = "$1"');
      // Dropdowns: Default -> CurrentOption { value }
      src = src.replace(/\bDefault\s*=\s*["']([^"']+)["']/gi, 'CurrentOption = { "$1" }');
      src = src.replace(/\bDefault\s*=\s*([^,}\s]+)/gi, function(match, p1) {
        // If a Default value is not quoted (number or true/false or nil), put it in braces
        if (/^(?:true|false|nil|\d+)$/.test(p1)) {
          return 'CurrentOption = { ' + p1 + ' }';
        }
        return match;
      });
      // In dropdowns, add MultipleOptions = false if Options exist (to clarify single-select)
      src = src.replace(/CreateDropdown\(\{\s*([^}]*Options\s*=\s*\{[^}]+\})/gi, 'CreateDropdown({ MultipleOptions = false, $1');
      // In dropdown callback, Rayfield passes an array (even for single select). We do not modify the callback, but user can handle accordingly.

      // Step 8: Flag and Save handling is mostly done: we removed Save above. Flag is kept intact by not removing it.
      // Step 9: Hold -> HoldToInteract for keybinds
      src = src.replace(/\bHold\s*=\s*/gi, 'HoldToInteract = ');
      // Step 10: TextDisappear -> RemoveTextAfterFocusLost for textboxes
      src = src.replace(/\bTextDisappear\b/gi, 'RemoveTextAfterFocusLost');
      // Step 11: ValueName -> Suffix for sliders
      src = src.replace(/\bValueName\b/gi, 'Suffix');
      // Step 12: Remove OrionLib:Destroy and CoreGui Orion references, replace with Rayfield:Destroy
      src = src.replace(/OrionLib:Destroy\(\)/gi, 'Rayfield:Destroy()')
               .replace(/game:GetService\(\s*["']CoreGui["']\s*\)\.Orion:Destroy\(\)/gi, 'Rayfield:Destroy()');

      // Step 13: Remove any lingering double commas or trailing commas that might have resulted from removals
      src = src.replace(/,\s*,/g, ',').replace(/,\s*}/g, ' }');

      return src;
    }

    // Handle Convert button click
    document.getElementById('convertBtn').addEventListener('click', function() {
      const input = document.getElementById('inputCode').value;
      const outputCodeElem = document.getElementById('outputCode');
      const spinner = document.getElementById('spinner');
      const convertBtnText = document.getElementById('convertBtnText');
      if (!input.trim()) {
        outputCodeElem.textContent = "";  // clear output if input is empty
        return;
      }
      // Show spinner and disable button during conversion
      this.disabled = true;
      spinner.style.display = 'inline-block';
      convertBtnText.textContent = 'Converting...';
      try {
        // Perform conversion
        const result = convertOrionToRayfield(input);
        // Insert and highlight result
        outputCodeElem.textContent = result;
        Prism.highlightElement(outputCodeElem);  // apply syntax highlighting to output
      } catch (err) {
        console.error("Conversion error:", err);
        outputCodeElem.textContent = "-- Conversion Error: " + err.message;
      }
      // Hide spinner and re-enable button
      spinner.style.display = 'none';
      convertBtnText.textContent = 'Convert';
      this.disabled = false;
      // Hide copy confirmation message if visible
      document.getElementById('copyConfirmMsg').classList.remove('show');
    });

    // Handle Copy Output button click
    document.getElementById('copyBtn').addEventListener('click', function() {
      const outputCodeElem = document.getElementById('outputCode');
      const copyMsg = document.getElementById('copyConfirmMsg');
      const codeText = outputCodeElem.textContent;
      if (!codeText) return;
      // Use Clipboard API if available
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(codeText).then(function() {
          copyMsg.classList.add('show');
          setTimeout(() => copyMsg.classList.remove('show'), 2000);
        }).catch(function(err) {
          console.error("Clipboard write failed", err);
          fallbackCopyText(codeText);
        });
      } else {
        fallbackCopyText(codeText);
      }
      // Fallback for older browsers
      function fallbackCopyText(text) {
        try {
          const textarea = document.createElement('textarea');
          textarea.value = text;
          textarea.style.position = 'fixed';  // avoid scrolling
          document.body.appendChild(textarea);
          textarea.focus();
          textarea.select();
          document.execCommand('copy');
          document.body.removeChild(textarea);
          copyMsg.classList.add('show');
          setTimeout(() => copyMsg.classList.remove('show'), 2000);
        } catch (err) {
          alert("Copy failed. Please select the text and copy manually.");
        }
      }
    });
  </script>
</body>
</html>
